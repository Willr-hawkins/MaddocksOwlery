{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="landing">
  <img class="landing-image" src="{% static 'images/maddocks-owlery.jpg' %}"
    alt="Maddocks Owlery with Simon Maddocks stood infront.">
</div>
<div class="container mt-4">
  <div class="main-content">
    <h2 class="text-center">Welcome to MaddocksOwlery.</h2>
    <h5 class="mt-2 text-center">A sanctuary for wildlife, a legacy for future generations.</h5>
    <hr style="margin-bottom: 50px;">
    <div class="row gx-5 d-flex align-items-stretch">
      <!-- Our story section -->
      <div class="col-md-6 col-12 info-block">
        <div class="our-story p-3 h-100">
          <h4 class="fw-bold subheading">| Our Story |</h4>
          <i class="bi bi-book-half"></i>
          <p>After running a beloved riding stables in North Devon for over three decades, 
              Simon Maddocks made a bold and heartfelt decision: to dedicate his land, time, and passion to nature recovery. In 2020, the stables closed, and the real work began.</p>

          <p>With 25 acres of personal land, and an additional 10 acres in collaboration with the National Trust, Simon began restoring habitats and encouraging biodiversity. 
            Nest boxes for owls and kestrels were installed. Partnerships were built â€” including one with the Bumblebee Conservation Trust to support the rare brown-banded Carder bee â€” and results were soon visible.</p>
        </div>
      </div>
      <!-- The wildlife Tower section -->
      <div class="col-md-6 col-12 info-block">
        <div class="wildlife-tower p-3 h-100">
          <h4 class="fw-bold subheading">| The Wildlife Tower |</h4>
          <i class="bi bi-building"></i>
          <p>In 2024, the dream of building a permanent, purpose-built wildlife tower became reality.</p>

          <p>Situated near one of the original owl boxes â€” which saw successful barn owl nesting â€” the tower is a response to the growing crisis of habitat loss. 
              Old barns once home to owls and bats are falling into disrepair or being converted into second homes. 
              The wildlife tower is Simonâ€™s answer: a structure designed to last a century, created only to serve nature.</p>
          
          <p>Constructed from locally sourced stone and shaped by local stonemasons, the tower reflects the land it stands on â€” rugged, rooted, and full of life.</p>
        </div>
      </div>
    </div>
    <hr style="margin: 50px 0;">
    <!-- Carousel for build process -->
    <div class="container mb-3">
      <h4 class="text-center fw-bold subheading mb-3">| Watch the Owlery take it's place. |</h4>
      <p class="text-center">
        <small>Hover over the images to pause the slideshow, or use the arrows to go back and forth.</small>
      </p>
      <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="false">
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="{% static 'images/owlery-build-1.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
          <div class="carousel-item">
            <img src="{% static 'images/owlery-build-2.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
          <div class="carousel-item">
            <img src="{% static 'images/owlery-build-3.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
          <div class="carousel-item">
            <img src="{% static 'images/owlery-build-4.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
          <div class="carousel-item">
            <img src="{% static 'images/owlery-build-5.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
          <div class="carousel-item">
            <img src="{% static 'images/owlery-build-6.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
          <div class="carousel-item">
            <img src="{% static 'images/owlery-build-7.jpg' %}" class="d-block w-100" alt="Build process of the owlery.">
          </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators"
          data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators"
          data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
    <!-- End of carousel -->
    <hr style="margin: 50px 0;">
    <div class="row gx-5 d-flex align-items-stretch">
      <!-- Conservation in action section -->
      <div class="col-md-6 col-12 info-block">
        <div class="conversation p-3 h-100">
          <h4 class="fw-bold subheading">| Conversation in Action |</h4>
          <i class="bi bi-megaphone"></i>
          <p>After running a beloved riding stables in North Devon for over three decades, 
              Simon Maddocks made a bold and heartfelt decision: to dedicate his land, time, and passion to nature recovery. In 2020, the stables closed, and the real work began.</p>

          <p>With 25 acres of personal land, and an additional 10 acres in collaboration with the National Trust, Simon began restoring habitats and encouraging biodiversity. 
            Nest boxes for owls and kestrels were installed. Partnerships were built â€” including one with the Bumblebee Conservation Trust to support the rare brown-banded Carder bee â€” and results were soon visible.</p>
        </div>
      </div>
      <!-- Wildlife section -->
      <div class="col-md-6 col-12 info-block">
        <div class="wildlife p-3 h-100">
          <h4 class="fw-bold subheading">| Wildlife & Land Stewardship |</h4>
          <i class="bi bi-tree"></i>
          <p>Maddocks Owlery isn't just a sanctuary for birds â€” it's part of a wider effort to nurture the ecosystem as a whole. On the surrounding meadows, 
              Simon uses Mangalica pigs and Belted Galloway cattle to manage the land in a natural way, promoting plant diversity and supporting pollinators.</p>

          <p>From bees to barn owls, the project fosters life across the food chain.</p>
        </div>
      </div>
    </div>
    <hr style="margin: 50px 0;">
    <!-- Short video by the team that helped create the owlery. -->
    <div class="container">
      <h4 class="text-center fw-bold subheading">| Want to see more? |</h4>
      <p class="text-center">Watch our short video below to explore the story behind Maddocks Owlery and the remarkable journey of its creation.</p>
      <br>
      <div class="video-container">
        <video id="owleryVideo" muted playsinline preload="metadata" width="900" height="600" controls>
          <source src="{% static 'videos/owlery-video.mp4' %}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <div class="button-wrapper" style="margin-top: 15px; display: flex; justify-content: center; gap: 15px;">
        <button id="unmuteButton" class="btn btn-outline-light">ðŸ”Š Unmute</button>
        <button id="playPauseBtn" class="btn btn-outline-light">Pause</button>
    </div>
    </div>
    <!-- End of short video -->
    <hr style="margin: 50px 0;">
    <div class="row gx-5 d-flex align-items-stretch">
      <!-- Community vision section -->
      <div class="col-md-6 col-12 info-block">
        <div class="community-vision p-3 h-100">
          <h4 class="fw-bold subheading">| community Vision |</h4>
          <i class="bi bi-sunglasses"></i>
          <p>The project has always been about more than just one manâ€™s vision. An 80% grant from North Devon National Landscape (formerly AONB), along with crowdfunding and local labor, 
            brought the tower to life. Itâ€™s a legacy created with the community â€” and for the community.</p>

          <p>Simon hopes to use the owlery not just for conservation, but also for education â€” inviting people to reconnect with the land and the life it supports.</p>
        </div>
      </div>
      <!-- be part of the journey section -->
      <div class="col-md-6 col-12 info-block">
        <div class="journey p-3 h-100">
          <h4 class="fw-bold subheading">| Be Part of the Journey |</h4>
          <i class="bi bi-person-walking"></i>
          <p>You can follow along with this story as it unfolds â€” from live camera feeds to seasonal sightings and milestones. 
            Check out our News page, The Gallery, or visit the Live Feed when the tower begins to hum with life.</p>
        </div>
      </div>
    </div>
    </div>
    <hr style="margin: 50px 0;">
    <br>
    <!-- Final message section -->
    <h4 class="text-center fw-bold" style="margin-bottom: 75px;">
      We would love for you to join us in celebrating and protecting the wildlife of North Devon â€” because every nest, every wingbeat, every wild corner matters.
    </h4>
  </div>
</div>

<!-- JavaScript for auto-sliding and auto-pausing when user hovers mouse over the top of the carousel. -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const carouselElement = document.querySelector('#carouselExampleIndicators');

    const bsCarousel = new bootstrap.Carousel(carouselElement, {
      interval: 2500,
      ride: false,
      pause: false // We'll handle pause on hover ourselves
    });

    let isVisible = false;

    // Handle visibility with IntersectionObserver
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        isVisible = entry.isIntersecting;

        if (isVisible) {
          bsCarousel.cycle();
        } else {
          bsCarousel.pause();
        }
      });
    }, {
      threshold: 0.5
    });

    observer.observe(carouselElement);

    // Pause on mouse hover
    carouselElement.addEventListener('mouseenter', () => {
      bsCarousel.pause();
    });

    // Resume when mouse leaves, but only if it's visible
    carouselElement.addEventListener('mouseleave', () => {
      if (isVisible) {
        bsCarousel.cycle();
      }
    });
  });
</script>

<!-- JavaScript for autoplay video when it comes into view along with unmute btn and play/pause btn. -->
<script>
document.addEventListener("DOMContentLoaded", function () {
  const video = document.getElementById("owleryVideo");
  const unmuteButton = document.getElementById("unmuteButton");
  const playPauseBtn = document.getElementById("playPauseBtn");

  let userPaused = false;
  let scrollPaused = false;

  // IntersectionObserver to handle autoplay on scroll
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        if (!userPaused) {
          video.play().catch(e => console.log("Autoplay blocked:", e));
          scrollPaused = false;
          playPauseBtn.textContent = "Pause";
        }
      } else {
        if (!video.paused) {
          video.pause();
          scrollPaused = true;
        }
      }
    });
  }, {
    threshold: 0.5
  });

  observer.observe(video);

  // Unmute/mute toggle
  unmuteButton.addEventListener("click", () => {
    video.muted = !video.muted;
    unmuteButton.textContent = video.muted ? "ðŸ”Š Unmute" : "ðŸ”‡ Mute";
  });

  // Play/pause button
  playPauseBtn.addEventListener("click", () => {
    if (video.paused) {
      video.play();
      playPauseBtn.textContent = "Pause";
      userPaused = false;
    } else {
      video.pause();
      playPauseBtn.textContent = "Play";
      userPaused = true;
    }
  });

  // Keep button in sync only if it's user-driven (not scroll)
  video.addEventListener("pause", () => {
    if (!scrollPaused && !video.ended && !video.seeking) {
      playPauseBtn.textContent = "Play";
      userPaused = true;
    }
  });

  video.addEventListener("play", () => {
    userPaused = false;
    scrollPaused = false;
    playPauseBtn.textContent = "Pause";
  });

  // Disable click-to-pause to prevent frustrating autoplay overrides
  video.addEventListener("click", (e) => {
    e.preventDefault();
  });
});
</script>
{% endblock %}